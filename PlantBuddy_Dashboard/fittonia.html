<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fittonia â€“ Live Data</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4faf2;
    padding: 20px;
  }
  .back {
    display: inline-block;
    margin-bottom: 20px;
    font-size: 18px;
    color: #2d6a33;
    text-decoration: none;
    font-weight: bold;
  }
  h1 {
    text-align: center;
    color: #3d8b40;
    margin-bottom: 20px;
  }
  .data-container {
    max-width: 700px;
    margin: auto;
  }
  .card {
    background: white;
    padding: 20px;
    border-radius: 14px;
    margin-bottom: 20px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.12);
  }
  .card h2 {
    margin-bottom: 12px;
    color: #4caf50;
  }
  .row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    font-size: 18px;
  }
  .label {
    font-weight: bold;
  }
  .ai-box {
    background: #e7f7e8;
    border-left: 6px solid #4caf50;
  }
</style>
</head>

<body>

<a class="back" href="index.html">â¬… Back to Dashboard</a>

<h1>ðŸŒ± Fittonia â€“ Live Data</h1>

<div class="data-container">
  <div class="card">
    <h2>Sensor Readings</h2>
    <div class="row"><span class="label">Soil Moisture:</span> <span id="soil">--</span></div>
    <div class="row"><span class="label">Light (lux):</span> <span id="light">--</span></div>
    <div class="row"><span class="label">Temperature (Â°C):</span> <span id="temp">--</span></div>
    <div class="row"><span class="label">Humidity (%):</span> <span id="humidity">--</span></div>
    <div class="row"><span class="label">Pump:</span> <span id="pump">--</span></div>
    <div class="row"><span class="label">Condition:</span> <span id="condition">--</span></div>
  </div>

  <div class="card ai-box">
    <h2>AI Classification (Edge Impulse)</h2>
    <div class="row"><span class="label">Prediction:</span> <span id="ai-label">--</span></div>
    <div class="row"><span class="label">Confidence:</span> <span id="ai-conf">--</span></div>
  </div>

  <div class="card">
    <h2>Moisture History</h2>
    <p style="text-align:center; color:#666;">(Chart will be added later)</p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<script>
  const SUPABASE_URL = "https://lkehixwlfdqsdebixcap.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxrZWhpeHdsZmRxc2RlYml4Y2FwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2MTk1NDYsImV4cCI6MjA4MDE5NTU0Nn0.HTt0VPEUgbkSJZfvIkuec6P6-TlHKr37c1FLl2hs6Ak";

  const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  function updateUI(row) {
    document.getElementById("soil").textContent = row.soil;
    document.getElementById("light").textContent = row.light;
    document.getElementById("temp").textContent = row.temp;
    document.getElementById("humidity").textContent = row.humidity;
    document.getElementById("pump").textContent = row.pump_state === 1 ? "ON" : "OFF";
    document.getElementById("condition").textContent = row.condition;

    if (row.ai_label) document.getElementById("ai-label").textContent = row.ai_label;
    if (row.ai_conf) document.getElementById("ai-conf").textContent = row.ai_conf;
  }

  async function loadLatest() {
    const { data, error } = await client
      .from('plant_data')
      .select('*')
      .eq('plant_id', 'fittonia')
      .order('id', { ascending: false })
      .limit(1);

    if (data && data.length > 0) updateUI(data[0]);
  }

  client
    .channel('plant_updates')
    .on(
      'postgres_changes',
      { event: 'INSERT', schema: 'public', table: 'plant_data' },
      (payload) => {
        if (payload.new.plant_id === "fittonia") {
          updateUI(payload.new);
        }
      }
    )
    .subscribe();

  loadLatest();
</script>

</body>
</html>